<!DOCTYPE html>
  <html>
    <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
      <title>req 3</title>
      <!-- reference the css and CDN -->
      <link rel="stylesheet" href="http://js.arcgis.com/3.9/js/esri/css/esri.css">
    <script src="http://js.arcgis.com/3.9/"></script>
    <script>

    // load modules
    var map;
      // [ ] = an array of modules available at js.arcgis.com
    //  function ( ) expects aliases for each module loaded, in same order as invoked in preceding array

    require (["esri/map",
      // explicitly requisite for popups
      "esri/dijit/Popup",
        "esri/dijit/PopupTemplate",
        //
    "esri/layers/FeatureLayer",
        "esri/symbols/SimpleLineSymbol",
        "esri/symbols/SimpleFillSymbol",
        "esri/symbols/TextSymbol",
        "esri/symbols/SimpleMarkerSymbol",
        "esri/renderers/SimpleRenderer",
        "esri/layers/LabelLayer",
        "dojo/_base/Color",
        // below new
        "dojo/dom-class",
        "dojo/dom-construct",
        "dojo/on",
        "dojox/charting/Chart",
        "dojox/charting/themes/Dollar",
        // above new
      "dojo/domReady!"], function(
        Map,
       Popup, PopupTemplate,
        FeatureLayer,
        SimpleLineSymbol, SimpleFillSymbol, TextSymbol, SimpleMarkerSymbol,
      SimpleRenderer,
          LabelLayer,
          Color,
          domClass,
          domConstruct,
          on,
          Chart, theme
        ){
    // define pop up
        var popup = Popup({
            titleInBody: false
        },domConstruct.create("div"));

      map = new Map("dubDiv", {

        center: [-6.178, 53.287],
        zoom: 10, // less intense zoom because Ireland wide
        basemap: "national-geographic", // works
        infoWindow: popup
      }); // end map init

      // define template for representing data in popup
      var hydroGauge = new PopupTemplate({
        title: "HydroMetric Gauges"
        });
      // note that text is returned all capslock from source
      var content = "<b>name</b>: ${STN_NAME}" +
        "<br><b>water body</b>: ${WATERBODY} MCF" +
        "<br><b>river basin</b>: ${RBD}" +
        "<br><b>Responsible</b>: ${LA}";
      hydroGauge.setContent(content);

      // add watercocks feature layer
      var waterLayer = new FeatureLayer("http://gis.epa.ie/arcgis101/rest/services/EPAMapServices/WaterFeatures/MapServer/1",{
            mode: FeatureLayer.MODE_ONDEMAND,
            outFields: ["*"],
            infoTemplate: hydroGauge
          });

      map.addLayer(waterLayer);

      // add another pop up and layer
      var airGauge = new PopupTemplate({title: "Air Monitoring Sites"});
      var airContent = "<br><b>coverage domain</b>: ${}"+
      "<br><b>______</b>: ${}"+
      "<br><b>______</b>: ${}"+
      "<br><b>______</b>: ${}"+
      "<br><b>______</b>: ${}";

      airGauge.setContent(airContent);

      // add a feature layer specific to air
      var airLayer = new FeatureLayer("http://gis.epa.ie/arcgis101/rest/services/EPAMapServices/AirQuality/MapServer/1", {
        mode: FeatureLayer.MODE_ONDEMAND,
        outFields: [],
        infoTemplate: airGauge
      });

      // map.addLayer(airLayer);
      // add county outlines
      // create a renderer
      // establish renderer parameters
      var countyColor = new Color("#FF00CC");
      var bLines = new SimpleLineSymbol("solid", countyColor, 1.5);
      var countySymbol = new SimpleFillSymbol("solid", bLines, null);
      var countyRenderer = new SimpleRenderer(countySymbol);
      var theURL = "http://services.arcgis.com/pMnvm7HXxTmNXxGi/arcgis/rest/services/Ireland_Counties/FeatureServer/0";

      var countyL = new FeatureLayer(theURL, {id: "counties"});
      countyL.setRenderer(countyRenderer);
      map.addLayer(countyL);

    }); // end require

    </script>
    <style>
    html, body, #dubDiv {
      padding: 0;
      margin: 0;
      height: 100%;
    }
    </style>
    </head>
    <body class="claro">
    <div id="dubDiv"></div>
  </body>
  </html>